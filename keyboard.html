<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oneida Language Keyboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Roboto", sans-serif;
            font-weight: 400;
            font-style: normal;
        }

        #container {
            text-align: center;
            margin: 20px auto;
            padding: 10px;
            max-width: 90%;
            justify-content: center;
        }
        
        #textInput {
            width: 90%;
            max-width: 500px;
            padding: 10px;
            margin-top: 10px;
            margin-left: 10px;
            margin-right: 10px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
            word-wrap: break-word;
            resize: vertical;
            height: 20px;
            min-height: 20px;
            max-height: 60px;
            font-family: "Roboto", sans-serif;
        }

        #copyButton, #clearTextBtn {
            padding: 12px 20px;
            font-size: 1em;
            background-color: #5D3F6A;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 5px;
        }

        #copyButton:hover, #clearTextBtn:hover {
            background-color: #ddd;
            color: black;
        }

        /* Mode Toggle Styles */
        .mode-toggle-container {
            text-align: center;
            margin: 30px auto 20px;
            max-width: 400px;
        }

        .mode-toggle {
            display: inline-flex;
            background-color: #f2f2f2;
            border-radius: 25px;
            padding: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mode-btn {
            padding: 12px 30px;
            font-size: 1em;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: transparent;
            color: #333;
            font-weight: 500;
        }

        .mode-btn.active {
            background-color: #5D3F6A;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .mode-btn:hover:not(.active) {
            background-color: #e0e0e0;
        }

        /* Option Toggles Styles */
        .options-container {
            text-align: center;
            margin: 20px auto;
            max-width: 600px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .toggle-option {
            display: flex;
            align-items: center;
            background-color: #f9f9f9;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .toggle-option:hover {
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .toggle-option label {
            margin-right: 10px;
            font-weight: 500;
            color: #333;
            cursor: pointer;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            cursor: pointer;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background-color: #5D3F6A;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .table-container {
            overflow-x: auto;
            margin: 20px auto;
            max-width: 350px;
        }

        table {
            border-collapse: collapse;
            width: auto;
            max-width: 300px;
            margin: auto;
            font-size: 1em;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 7px;
            text-align: center;
            overflow: hidden;
            white-space: nowrap;
            width: 150px;
            max-width: 300px;
        }

        th {
            background-color: #f2f2f2;
        }

        caption {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .navbar {
            background-color: #5D3F6A;
            display: flex;
            flex-wrap: wrap;
            justify-content: left;
            text-align: center;
        }

        .navbar a {
            font-size: 1.3em;
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            text-align: left;
        }

        .navbar a:hover {
            background-color: #ddd;
            color: black;
        }

        .dropdown {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }   
        
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 100px;
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
            z-index: 1;
            top: 100%;
            left: 0;
        }
        
        .dropdown-content.show {
            display: block;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .dropdown:hover > a {
            background-color: #ddd;
            color: black;
        }

        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        #copyMessage, #clearMessage {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .navbar {
                justify-content: center;
            }
            
            .navbar a {
                font-size: 1.1em;
                padding: 10px 20px;
            }
            
            #textInput {
                font-size: 0.8em;
                padding: 8px;
            }

            #copyButton, #clearTextBtn {
                font-size: 0.8em;
                padding: 10px 15px;
            }

            .mode-btn {
                padding: 10px 20px;
                font-size: 0.9em;
            }

            .toggle-option {
                padding: 8px 15px;
            }

            .toggle-option label {
                font-size: 0.9em;
            }

            table th, table td {
                font-size: 0.8em;
            }
            
            caption {
                font-size: 1em;
            }
        }

        @media (max-width: 480px) {
            .navbar {
                justify-content: center;
            }
            
            .navbar a {
                font-size: 0.8em;
                padding: 10px 20px;
            }

            #textInput {
                font-size: .6em;
                padding: 8px;
            }

            #copyButton, #clearTextBtn {
                font-size: 0.6em;
                padding: 8px 12px;
            }

            .mode-btn {
                padding: 8px 15px;
                font-size: 0.8em;
            }

            .toggle-option {
                padding: 6px 12px;
            }

            .toggle-option label {
                font-size: 0.8em;
                margin-right: 8px;
            }

            .toggle-switch {
                width: 40px;
                height: 22px;
            }

            .toggle-slider:before {
                height: 16px;
                width: 16px;
            }

            .toggle-switch input:checked + .toggle-slider:before {
                transform: translateX(18px);
            }

            table th, table td {
                font-size: 0.6em;
            }
            
            caption {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="index.html">Home</a>
        <a href="keyboard.html">Keyboard</a>
        <div class="dropdown">
            <a>Charts</a>
            <div class="dropdown-content">
                <a href="possessives.html">Possessives</a>
                <a href="pronouns.html">Pronouns</a>
                <a href="transitives.html">Transitives</a>
            </div>
        </div>
        <div class="dropdown">
            <a>Dictionaries</a>
            <div class="dropdown-content">
                <a href="nouns.html">Nouns</a>
                <a href="particles.html">Particles</a>
            </div>
        </div>
    </div>

    <!-- Mode Toggle -->
    <div class="mode-toggle-container">
        <div class="mode-toggle">
            <button class="mode-btn active" id="typeModeBtn">Type Mode</button>
            <button class="mode-btn" id="convertModeBtn">Font Mode</button>
        </div>
    </div>

    <div id="container">
        <textarea id="textInput" rows="4" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Type here using the Unicode keyboard..."></textarea>
    </div>
    <div id="container">
        <button id="copyButton">Copy Text</button>
        <button id="clearTextBtn">Clear Text</button>
    </div>
    <div id="copyMessage">Text copied!</div>
    <div id="clearMessage">Text cleared!</div>
    
    <!-- Option Toggles -->
    <div class="options-container">
        <div class="toggle-option">
            <label for="allowEnglishToggle">Allow English Keys</label>
            <label class="toggle-switch">
                <input type="checkbox" id="allowEnglishToggle">
                <span class="toggle-slider"></span>
            </label>
        </div>
        <div class="toggle-option">
            <label for="dialectToggle">Change Dialect</label>
            <label class="toggle-switch">
                <input type="checkbox" id="dialectToggle">
                <span class="toggle-slider"></span>
            </label>
        </div>
    </div>

    <div class="table-container">
        <table id="keyMappings">
            <caption>Key Mappings</caption>
            <thead>
                <tr>
                    <th>English Key</th>
                    <th>Oneida Symbol</th>
                </tr>
            </thead>
            <tbody id="mappingsBody">
                <!-- Mappings will be inserted here by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
    // Mode state
    let currentMode = 'type';
    let allowEnglish = false;
    let alternateDialect = false;

    // Type Mode mappings (Unicode Keyboard) - Updated with combining accents
    const typeModeMap = {
        'A': 'á', 
        'E': 'é', 
        'I': 'í', 
        'O': 'ó', 
        'U': 'ú',
        '<': 'ʌ', 
        '>': 'ʌ\u0301',
        '?': 'ˀ', 
        '-': '⋅',
        'H': 'h', 
        'K': 'k', 
        'L': 'l', 
        'N': 'n', 
        'S': 's', 
        'T': 't',
        'W': 'w', 
        'Y': 'y',
        '1': 'Á',
        '2': 'É',
        '3': 'Í',
        '4': 'Ó',
        '5': 'Ú',
        '6': 'Ʌ\u0301',
        '7': 'Ʌ'
    };

    // Convert Mode mappings (Font Converter)
    const convertModeMap = {
        '@': 'á', 
        '#': 'é', 
        '$': 'í', 
        '%': 'ó', 
        '&': 'ú',
        '<': 'ʌ', 
        '^': 'ʌ\u0301',
        'Á': 'á', 
        'É': 'é', 
        'Í': 'í', 
        'Ó': 'ó', 
        'Ú': 'ú',
        'Ʌ\u0301': 'ʌ\u0301',
        '>': 'ˀ', 
        '=': '⋅',
        'H': 'h', 'K': 'k', 'L': 'l', 'N': 'n', 'S': 's', 'T': 't',
        'W': 'w', 'Y': 'y', 'A': 'a', 'E': 'e', 'I': 'i', 'O': 'o', 'U': 'u', 'Ʌ': 'ʌ'
    };

    // Base allowed characters for Type mode
    const typeModeBaseChars = new Set([
        'A', 'á', 'E', 'é', 'I', 'í', 'O', 'ó', 'U', 'ú', 
        'H', 'h', 'K', 'k', 'L', 'l', 'N', 'n', 'S', 's', 'T', 't', 'W', 'w', 'Y', 'y',
        '<', 'ʌ', '>', '?', 'ˀ', '-', '⋅',
        '1', 'Á', '2', 'É', '3', 'Í', '4', 'Ó', '5', 'Ú', '6', 'Ʌ', '7',
        ' ', '\n', '_', '\u0332', '\u0301',
        'a', 'e', 'i', 'o', 'u', "'", ':'
    ]);

    // Base allowed characters for Convert mode
    const convertModeBaseChars = new Set([
        '@', 'á', '#', 'é', '$', 'í', '%', 'ó', '&', 'ú', 'H', 'K', 'L', 'N', 'S', 'T', 'W', 'Y', 'A', 'E', 'I', 'O', 'U', 
        '<', 'ʌ', '>', 'ʌ́', '^', 'ˀ', '=', '⋅', 'Á', 'É', 'Í', 'Ó', 'Ú', 'Ʌ\u0301',
        'a', 'e', 'i', 'o', 'u', ' ', '\n', '\u0332', '\u0301', "'", ':'
    ]);

    // English characters to add when English mode is enabled (no capitals except special cases)
    const englishChars = new Set([
        'b', 'c', 'd', 'f', 'g', 'j', 'm', 'p', 'q', 'r', 'v', 'x', 'z',
        'B', 'C', 'D', 'F', 'G', 'J', 'M', 'P', 'Q', 'R', 'V', 'X', 'Z',
        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
        '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '[', ']', '{', '}',
        ',', '.', ';', ':', '?', '/', '\\', '|', '~', '`', '+', '=', '"', "'"
    ]);

    function getAllowedChars() {
        const baseChars = currentMode === 'type' ? typeModeBaseChars : convertModeBaseChars;
        if (allowEnglish) {
            return new Set([...baseChars, ...englishChars]);
        }
        return baseChars;
    }

    // Display mappings for the table (standard dialect)
    const typeModeDisplayStandard = [
        ['A', 'á'], ['E', 'é'], ['I', 'í'], ['O', 'ó'], ['U', 'ú'],
        ['>', 'ʌ́'], ['<', 'ʌ'], ['?', 'ˀ'], ['-', '⋅'], ['_', '⋅̲⋅̲⋅̲']
    ];

    const convertModeDisplayStandard = [
        ['@', 'á'], ['#', 'é'], ['$', 'í'], ['%', 'ó'], ['&', 'ú'],
        ['^', 'ʌ́'], ['<', 'ʌ'], ['>', 'ˀ'], ['=', '⋅']
    ];

    // Display mappings for the table (alternate dialect)
    const typeModeDisplayAlternate = [
        ['A', 'á'], ['E', 'é'], ['I', 'í'], ['O', 'ó'], ['U', 'ú'],
        ['>', 'ʌ́'], ['<', 'ʌ'], ['?', "'"], ['-', ':'], ['_', '⋅̲⋅̲⋅̲']
    ];

    const convertModeDisplayAlternate = [
        ['@', 'á'], ['#', 'é'], ['$', 'í'], ['%', 'ó'], ['&', 'ú'],
        ['^', 'ʌ́'], ['<', 'ʌ'], ['>', "'"], ['=', ':']
    ];

    function updateMappingsTable() {
        const tbody = document.getElementById('mappingsBody');
        tbody.innerHTML = '';
        
        let mappings;
        if (currentMode === 'type') {
            mappings = alternateDialect ? typeModeDisplayAlternate : typeModeDisplayStandard;
        } else {
            mappings = alternateDialect ? convertModeDisplayAlternate : convertModeDisplayStandard;
        }
        
        mappings.forEach(([key, symbol]) => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${key}</td><td>${symbol}</td>`;
            tbody.appendChild(row);
        });
    }

    function applyDialectConversion(text) {
        if (!alternateDialect) return text;
        
        // Replace glottal and raised dot with apostrophe and colon
        return text.replace(/ˀ/g, "'").replace(/⋅/g, ':');
    }

    // Type Mode conversion with proper underline handling
    function convertToIPATypeMode(text) {
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            
            if (char === '_') {
                if (result.length >= 2) {
                    const lastChar = result[result.length - 1];
                    const secondLast = result[result.length - 2];
                    
                    if (lastChar === '\u0301') {
                        if (result.length >= 3 && result[result.length - 2] === '\u0332') {
                            continue;
                        }
                        result = result.slice(0, -2) + secondLast + '\u0332' + '\u0301';
                        continue;
                    }
                    else if (lastChar === '\u0332') {
                        continue;
                    }
                    else {
                        result = result.slice(0, -1) + lastChar + '\u0332';
                        continue;
                    }
                } else if (result.length === 1) {
                    const lastChar = result[result.length - 1];
                    result = result.slice(0, -1) + lastChar + '\u0332';
                    continue;
                }
            }
            
            let convertedChar = typeModeMap[char] || char;
            result += convertedChar;
        }
        
        return applyDialectConversion(result);
    }

    // Convert Mode conversion
    function convertToIPAConvertMode(text) {
        let result = '';
        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            if (char === '_') {
                if (result.length > 0) {
                    let lastChar = result[result.length - 1];
                    result = result.slice(0, -1) + lastChar + '\u0332';
                }
                continue;
            }
            let convertedChar = convertModeMap[char] || char;
            result += convertedChar;
        }
        
        return applyDialectConversion(result);
    }

    function setMode(mode) {
        currentMode = mode;
        const textInput = document.getElementById('textInput');
        const typeModeBtn = document.getElementById('typeModeBtn');
        const convertModeBtn = document.getElementById('convertModeBtn');

        if (mode === 'type') {
            typeModeBtn.classList.add('active');
            convertModeBtn.classList.remove('active');
            textInput.placeholder = 'Type text here to use keyboard...';
        } else {
            convertModeBtn.classList.add('active');
            typeModeBtn.classList.remove('active');
            textInput.placeholder = 'Paste font text here to convert...';
        }

        updateMappingsTable();
        textInput.value = '';
    }

    document.getElementById('textInput').addEventListener('input', function(e) {
        const value = e.target.value;
        const allowedChars = getAllowedChars();
        let converted;

        if (currentMode === 'type') {
            const filtered = value.split('').filter(char => 
                allowedChars.has(char.toUpperCase()) || allowedChars.has(char)
            ).join('');
            converted = convertToIPATypeMode(filtered);
        } else {
            const filtered = value.split('').filter(char => 
                allowedChars.has(char.toUpperCase()) || allowedChars.has(char)
            ).join('');
            converted = convertToIPAConvertMode(filtered);
        }

        e.target.value = converted;
    });

    function copyToClipboard() {
        const input = document.getElementById('textInput');
        input.select();
        input.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(input.value).then(() => {
            const copyMessage = document.getElementById('copyMessage');
            copyMessage.style.display = 'block';
            copyMessage.style.opacity = '1';
            setTimeout(() => {
                copyMessage.style.opacity = '0';
                setTimeout(() => {
                    copyMessage.style.display = 'none';
                }, 1000);
            }, 2000);
        });
    }

    document.getElementById('copyButton').addEventListener('click', copyToClipboard);
    
    document.getElementById('clearTextBtn').addEventListener('click', function() {
        document.getElementById('textInput').value = '';
        
        const clearMessage = document.getElementById('clearMessage');
        clearMessage.style.display = 'block';
        clearMessage.style.opacity = '1';
        
        setTimeout(() => {
            clearMessage.style.opacity = '0';
            setTimeout(() => {
                clearMessage.style.display = 'none';
            }, 1000);
        }, 2000);
    });

    document.getElementById('typeModeBtn').addEventListener('click', () => setMode('type'));
    document.getElementById('convertModeBtn').addEventListener('click', () => setMode('convert'));
    
    // Toggle handlers
    document.getElementById('allowEnglishToggle').addEventListener('change', function(e) {
        allowEnglish = e.target.checked;
    });

    document.getElementById('dialectToggle').addEventListener('change', function(e) {
        alternateDialect = e.target.checked;
        updateMappingsTable();
        
        // Reprocess current text
        const textInput = document.getElementById('textInput');
        const currentText = textInput.value;
        textInput.value = '';
        textInput.value = currentText;
        textInput.dispatchEvent(new Event('input'));
    });
    
    document.addEventListener('DOMContentLoaded', () => {
        setMode('type');

        const dropdowns = document.querySelectorAll('.dropdown');
        dropdowns.forEach(dropdown => {
            const toggle = dropdown.querySelector('a');
            const dropdownContent = dropdown.querySelector('.dropdown-content');

            toggle.addEventListener('click', (e) => {
                e.preventDefault();
                dropdownContent.classList.toggle('show');
            });

            document.addEventListener('click', (event) => {
                if (!dropdown.contains(event.target)) {
                    dropdownContent.classList.remove('show');
                }
            });
        });
    });
    </script>
</body>
</html>
